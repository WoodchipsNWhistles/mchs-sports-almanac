---
layout: base.njk
pagination:
  data: gwbbSeasons
  size: 1
  alias: s
permalink: "/gwbb/season/{{ s.yearEnd }}/index.html"
---

<header>
  <p class="kicker"><a href="{{ '/gwbb/season/' | url }}">← Back to Seasons</a></p>
  <h1 class="masthead-title">GWBB {{ s.label }}</h1>
  <hr class="rule">
</header>


{# Derived season summary (W–L, PF/PA, lede) #}
{% set summary = gwbbSeasonSummaries[s.yearEnd] or {} %}
{# Canonical postseason metadata (flags) #}
{% set meta = gwbbSeasonMeta[s.yearEnd] or {} %}

{% if meta and meta.seasonYearEnd %}
  <div class="box" style="margin: 1rem 0;">
    <h3 style="margin:0 0 .5rem; font-family: var(--masthead);">Season at a glance</h3>
{% if summary.lede %}
  <p class="small" style="margin:.5rem 0 0;"><em>{{ summary.lede }}</em></p>
{% endif %}
    <p class="small" style="margin:.25rem 0;">
<strong>Head coach:</strong> {{ summary.coachName or meta.coachId or "—" }}

    </p>
    
    {% if summary.wins is defined %}
  <p class="small" style="margin:.25rem 0;"><strong>Record:</strong> {{ summary.wins }}–{{ summary.losses }}</p>
  <p class="small" style="margin:.25rem 0;"><strong>Points:</strong> {{ summary.pfTotal }}–{{ summary.paTotal }}</p>
{% endif %}


{% if meta.districtChampion == 1 or meta.districtRunnerUp == 1 %}
  <p class="small" style="margin:.25rem 0;">
    <strong>District:</strong>
    {% if meta.districtChampion == 1 %}
      Champion
    {% else %}
      Runner-up
    {% endif %}
  </p>
{% endif %}

{% if meta.regionChampion == 1 or meta.regionRunnerUp == 1 %}
  <p class="small" style="margin:.25rem 0;">
    <strong>Region:</strong>
    {% if meta.regionChampion == 1 %}
      Champion
    {% elif meta.regionRunnerUp == 1 %}
      Runner-up
    {% endif %}
  </p>
{% endif %}


{% if
  meta.stateChampion == 1
  or meta.stateFinalist == 1
  or meta.stateFinalFour == 1
  or meta.stateElite8 == 1
  or meta.stateSweet16 == 1
%}
  <p class="small" style="margin:.25rem 0;">
    <strong>State:</strong>
    {% if meta.stateChampion == 1 %}
      Champion
    {% elif meta.stateFinalist == 1 %}
      Finalist
    {% elif meta.stateFinalFour == 1 %}
      Final Four
    {% elif meta.stateElite8 == 1 %}
      Elite Eight
    {% elif meta.stateSweet16 == 1 %}
      Sweet 16
    {% endif %}
  </p>
{% endif %}

    </p>
  </div>
{% endif %}


{% if seasonJsonMissing %}
  <p><em>Season JSON missing for {{ s.yearEnd }}.</em></p>

{% elif season %}
  {% if season.schedule and season.schedule.length %}
    {# Collect all gameIDs that have at least one stat row (means: boxscore content exists) #}
    {% set boxIds = [] %}
    {% for st in (season.gameStats or []) %}
      {% set gid = st.gameId or st.gameID or st.GameID %}
      {% if gid and (gid not in boxIds) %}
        {% set boxIds = boxIds.concat([gid]) %}
      {% endif %}
    {% endfor %}

    <h2>Schedule</h2>

    <table>
<thead>
  <tr>
    <th>Date</th>
    <th>Opp</th>
    <th>Result</th>
  </tr>
</thead>

      <tbody>
  {% for g in season.schedule %}
    {# Canonical-ish game id across eras #}
  {% set gid = g.gameId or g.gameID or g.GameID or g.GameId or g.GameID_Base or g.gameIdBase or g.GameIDBase %}
  {% set opp = g.opponent or g.Opponent or 'Opponent' %}
  {% set dateLabel = g.dateLabel or g.Date %}
  {% set notes = (g.notes or g.Notes or '') | string %}
{# Detect cancelled games #}
{% set outcomeRaw = (g.outcome or g.Outcome or '') | string | lower %}
{% set notesLower = notes | lower %}
{% set isCancelled =
  'cancel' in outcomeRaw
  or 'cancel' in notesLower
%}


    {# Site code #}
    {% set sc = (g.siteCode or g.SiteCode or '') | upper %}

    {% if sc == 'A' %}
      {% set gameLabel = '@ ' ~ opp %}
    {% elif sc == 'H' %}
      {% set gameLabel = 'vs ' ~ opp %}
    {% elif sc == 'N' %}
      {% set gameLabel = opp ~ ' (N)' %}
    {% else %}
      {% set gameLabel = opp %}
    {% endif %}

    {# Result #}
{% set outcomeRaw = (g.outcome or g.Outcome or '') | string | lower %}
{% set firstChar = outcomeRaw | slice(0, 1) %}

{% if firstChar == 'w' %}
  {% set wl = 'W' %}
{% elif firstChar == 'l' %}
  {% set wl = 'L' %}
{% else %}
  {% set wl = (g.outcome or g.Outcome or '—') %}
{% endif %}


    {% set pf = g.pointsFor or g["Points for"] %}
    {% set pa = g.pointsAgainst or g["Points Against"] %}

    <tr>
      <td>{{ dateLabel }}</td>

           <td>
  {% if gid and (gid in boxIds) %}
    <a href="{{ ('/gwbb/boxscores/' ~ gid ~ '/') | url }}">{{ gameLabel }}</a>
  {% else %}
    {{ gameLabel }}
  {% endif %}

  {% if notes and notes != 'null' %}
    <div class="small muted" style="margin-top:.15rem;">
      {{ notes }}
    </div>
  {% endif %}
</td>


      <td>
  {% if isCancelled %}
    Cancelled
  {% else %}
    {{ wl }}
    {% if pf is not none and pa is not none %}
      {{ pf }}–{{ pa }}
    {% endif %}
  {% endif %}
</td>

    </tr>
  {% endfor %}
</tbody>

    </table>

  {% else %}
    <p>No schedule found in season JSON.</p>
  {% endif %}

{% else %}
  <p><em>No season object loaded.</em></p>
{% endif %}

<footer class="article">
  <div class="box">
    <h3 style="margin:0 0 .5rem; font-family: var(--masthead);">Data provenance</h3>
    <p class="small" style="margin:0;">
      Season data compiled from official records and scorebooks.
    </p>
    <p class="small" style="margin:.5rem 0 0;">
      JSON source:
      <a href="{{ s.jsonUrl | url }}">{{ s.jsonUrl }}</a>
    </p>
  </div>
</footer>
