---
layout: base.njk
pagination:
  data: gwbbSeasons
  size: 1
  alias: s
permalink: "/gwbb/season/{{ s.yearEnd }}/index.html"
eleventyComputed:
  title: "Greenwave Basketball - {{ s.yearEnd }}"
---

<header>
  <p class="kicker"><a href="{{ '/gwbb/' | url }}">← Back to Greenwave Basketball</a></p>
  <h1 class="masthead-title">GWBB {{ s.label }}</h1>
  <hr class="rule">
</header>


{% if seasonJsonMissing %}
  <p><em>Season JSON missing for {{ s.yearEnd }}.</em></p>

{% elif season %}

  {# pick schedule from either key, but your debug shows season.schedule exists #}
  {% set sched = season.schedule or season.Schedule or [] %}

  {% if sched and sched.length %}

    {# Collect all gameIDs that have at least one stat row (means: boxscore content exists) #}
    {% set boxIds = [] %}
    {% for st in (season.gameStats or []) %}
      {% set gid0 = st.gameId or st.gameID or st.GameID %}
      {% if gid0 and (gid0 not in boxIds) %}
        {% set boxIds = boxIds.concat([gid0]) %}
      {% endif %}
    {% endfor %}

    <h2>Schedule</h2>

    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Opp</th>
          <th>Result</th>
        </tr>
      </thead>
      <tbody>
        {% for g in sched %}
          {# Canonical-ish game id across eras #}
          {% set gid = g.gameId or g.gameID or g.GameID or g.GameId or g.GameID_Base or g.gameIdBase or g.GameIDBase %}
          {% set opp = g.opponent or g.Opponent or 'Opponent' %}
          {% set dateLabel = g.dateLabel or g.Date or g.GameDate %}
          {% set notes = (g.notes or g.Notes or '') | string %}

          {# Detect cancelled games #}
          {% set outcomeRaw = (g.outcome or g.Outcome or g.Result or '') | string | lower %}
          {% set notesLower = notes | lower %}
          {% set isCancelled = ('cancel' in outcomeRaw) or ('cancel' in notesLower) %}

          {# Site code #}
          {% set sc = (g.siteCode or g.SiteCode or '') | upper %}
          {% if sc == 'A' %}
            {% set gameLabel = '@ ' ~ opp %}
          {% elif sc == 'H' %}
            {% set gameLabel = 'vs ' ~ opp %}
          {% elif sc == 'N' %}
            {% set gameLabel = opp ~ ' (N)' %}
          {% else %}
            {% set gameLabel = opp %}
          {% endif %}

          {# W/L label #}
          {% set firstChar = outcomeRaw | slice(0, 1) %}
          {% if firstChar == 'w' %}
            {% set wl = 'W' %}
          {% elif firstChar == 'l' %}
            {% set wl = 'L' %}
          {% else %}
            {% set wl = (g.outcome or g.Outcome or g.Result or '—') %}
          {% endif %}

          {# Score fields across eras #}
          {% set pf = g.pointsFor or g["Points for"] or g.MC %}
          {% set pa = g.pointsAgainst or g["Points Against"] or g.OPP %}

          <tr>
            <td>{{ dateLabel }}</td>
            <td>
              {% if gid and (gid in boxIds) %}
                <a href="{{ ('/gwbb/boxscores/' ~ gid ~ '/') | url }}">{{ gameLabel }}</a>
              {% else %}
                {{ gameLabel }}
              {% endif %}

              {% if notes and notes != 'null' %}
                <div class="small muted" style="margin-top:.15rem;">{{ notes }}</div>
              {% endif %}
            </td>
            <td>
              {% if isCancelled %}
                Cancelled
              {% else %}
                {{ wl }}
                {% if pf is not none and pa is not none %}
                  {{ pf }}–{{ pa }}
                {% endif %}
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

  {% else %}
    <p>No schedule found in season JSON.</p>
  {% endif %}

{% else %}
  <p><em>No season object loaded.</em></p>
{% endif %}

<footer class="article">
  <div class="box">
    <h3 style="margin:0 0 .5rem; font-family: var(--masthead);">Data provenance</h3>
    <p class="small" style="margin:0;">
      Season data compiled from official records and scorebooks.
    </p>
    <p class="small" style="margin:.5rem 0 0;">
      JSON source:
      <a href="{{ s.jsonUrl | url }}">{{ s.jsonUrl }}</a>
    </p>
  </div>
</footer>
